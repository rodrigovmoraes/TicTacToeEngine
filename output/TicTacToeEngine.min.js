var MinMax=function(){this.status=null};MinMax.prototype=function(){var p=function(t,s,i,r,u,a,n){var e,h,l,o,f;if(s<0||t.isEnd())return{value:t.getValue(u,a),status:t};if(n){for(e=Number.NEGATIVE_INFINITY,l=t.getChildren(u),o=0;o<l.length&&(e<(h=p(l[o],s-1,i,r,u,a,!1).value)?(e=h,f=o):h===e&&l[o].isEnd()&&(f=o),!(r<=(i=Math.max(i,h))));o++);return{value:e,status:l[f]}}for(e=Number.POSITIVE_INFINITY,l=t.getChildren(a),o=0;o<l.length&&((h=p(l[o],s-1,i,r,u,a,!0).value)<e?(e=h,f=o):h===e&&l[o].isEnd()&&(f=o),!((r=Math.min(r,h))<=i));o++);return{value:e,status:l[f]}};return{setStatus:function(t){this.status=t},getValue:function(t,s){return p(this.status,10,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,t,s,!0)}}}();var TicTacToeEngine=function(){this.status=new TicTacToeStatus,this.listener=null};TicTacToeEngine.prototype=function(){var i=function(){var t,s;Number.POSITIVE_INFINITY;(t=new MinMax).setStatus(this.status),s=t.getValue(this.status.CPU,this.status.PLAYER),this.status=s.status,this.listener&&this.listener.update(s.status)};return{cpuPlay:i,play:function(t,s){return t<3&&s<3&&0<=t&&0<=s&&(this.status.isEnd()||this.status.gridValues[t][s]===this.status.EMPTY&&(this.status.gridValues[t][s]=this.status.PLAYER,this.listener&&this.listener.update(this.status),i.apply(this))),this.status.gridValues},isEnd:function(){return!!this.status&&this.status.isEnd()},playerWon:function(){return!!this.status&&this.status.playerWon(this.status.PLAYER,this.status.CPU)},cpuWon:function(){return!!this.status&&this.status.playerWon(this.status.CPU,this.status.PLAYER)}}}();var TicTacToeStatus=function(){var t,s;for(this.gridValues=[],t=0;t<3;t++)for(this.gridValues[t]=[],s=0;s<3;s++)this.gridValues[t][s]=0;this.EMPTY=0,this.PLAYER=1,this.CPU=2};TicTacToeStatus.prototype=function(){var n=function(){var t,s,i=[[this.EMPTY,this.EMPTY,this.EMPTY],[this.EMPTY,this.EMPTY,this.EMPTY],[this.EMPTY,this.EMPTY,this.EMPTY]];for(t=0;t<3;t++)for(s=0;s<3;s++)i[t][s]=this.gridValues[t][s];return i},u=function(t,s,i){var r;if(t<3){for(r=0;r<3;r++)if(this.gridValues[t][r]===i)return 0;var u=0;for(r=0;r<3;r++)this.gridValues[t][r]===s&&u++;return u}return 0},a=function(t,s,i){var r;if(t<3){for(r=0;r<3;r++)if(this.gridValues[r][t]===i)return 0;var u=0;for(r=0;r<3;r++)this.gridValues[r][t]===s&&u++;return u}return 0},e=function(t,s,i){var r,u;if(t){for(r=0;r<3;r++)if(this.gridValues[r][r]===i)return 0;for(r=u=0;r<3;r++)this.gridValues[r][r]===s&&u++;return u}for(r=0;r<3;r++)if(this.gridValues[r][2-r]===i)return 0;for(r=u=0;r<3;r++)this.gridValues[r][2-r]===s&&u++;return u},i=function(t,s){var i,r=0;for(i=0;i<3;i++)r=Math.max(r,u.apply(this,[i,t,s]));for(i=0;i<3;i++)r=Math.max(r,a.apply(this,[i,t,s]));return r=Math.max(r,e.apply(this,[!0,t,s])),r=Math.max(r,e.apply(this,[!1,t,s]))},r=function(){return 3===i.apply(this,[this.PLAYER,this.CPU])||3===i.apply(this,[this.CPU,this.PLAYER])||!function(){var t,s;for(t=0;t<3;t++)for(s=0;s<3;s++)if(this.gridValues[t][s]===this.EMPTY)return!0;return!1}.apply(this)};return{getPlayerValue:i,getValue:function(t,s){return i.apply(this,[t,s])-i.apply(this,[s,t])},setGrid:function(t){var s,i,r,u=!0;if(3===t.length)for(s=0;s<3;s++)3!==t[s].length&&(u=!1);else u=!1;if(u)for(i=0;i<3;i++)for(r=0;r<3;r++)this.gridValues[i][r]=t[i][r]},getChildren:function(t){var s,i,r,u,a=[];for(s=0;s<3;s++)for(i=0;i<3;i++)this.gridValues[s][i]===this.EMPTY&&((r=n.apply(this,[t]))[s][i]=t,(u=new TicTacToeStatus).setGrid(r),a.push(u));return a},isEnd:r,playerWon:function(t,s){return r.apply(this)&&3===i.apply(this,[t,s])}}}();