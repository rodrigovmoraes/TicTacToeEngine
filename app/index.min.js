var MinMax=function(){this.status=null};MinMax.prototype=function(){var c=function(t,e,i,s,n,r,a){var u,h,l,o,d;if(e<0||t.isEnd())return{value:t.getValue(n,r),status:t};if(a){for(u=Number.NEGATIVE_INFINITY,l=t.getChildren(n),o=0;o<l.length&&(u<(h=c(l[o],e-1,i,s,n,r,!1).value)?(u=h,d=o):h===u&&l[o].isEnd()&&(d=o),!(s<=(i=Math.max(i,h))));o++);return{value:u,status:l[d]}}for(u=Number.POSITIVE_INFINITY,l=t.getChildren(r),o=0;o<l.length&&((h=c(l[o],e-1,i,s,n,r,!0).value)<u?(u=h,d=o):h===u&&l[o].isEnd()&&(d=o),!((s=Math.min(s,h))<=i));o++);return{value:u,status:l[d]}};return{setStatus:function(t){this.status=t},getValue:function(t,e){return c(this.status,10,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,t,e,!0)}}}();var TicTacToeEngine=function(){this.status=new TicTacToeStatus,this.listener=null};TicTacToeEngine.prototype=function(){var i=function(){var t,e;Number.POSITIVE_INFINITY,(t=new MinMax).setStatus(this.status),e=t.getValue(this.status.CPU,this.status.PLAYER),this.status=e.status,this.listener&&this.listener.update(e.status)};return{cpuPlay:i,play:function(t,e){return t<3&&e<3&&0<=t&&0<=e&&(this.status.isEnd()||this.status.gridValues[t][e]===this.status.EMPTY&&(this.status.gridValues[t][e]=this.status.PLAYER,this.listener&&this.listener.update(this.status),i.apply(this))),this.status.gridValues},isEnd:function(){return!!this.status&&this.status.isEnd()},playerWon:function(){return!!this.status&&this.status.playerWon(this.status.PLAYER,this.status.CPU)},cpuWon:function(){return!!this.status&&this.status.playerWon(this.status.CPU,this.status.PLAYER)}}}();var TicTacToeStatus=function(){var t,e;for(this.gridValues=[],t=0;t<3;t++)for(this.gridValues[t]=[],e=0;e<3;e++)this.gridValues[t][e]=0;this.EMPTY=0,this.PLAYER=1,this.CPU=2};TicTacToeStatus.prototype=function(){var a=function(){var t,e,i=[[this.EMPTY,this.EMPTY,this.EMPTY],[this.EMPTY,this.EMPTY,this.EMPTY],[this.EMPTY,this.EMPTY,this.EMPTY]];for(t=0;t<3;t++)for(e=0;e<3;e++)i[t][e]=this.gridValues[t][e];return i},n=function(t,e,i){var s;if(t<3){for(s=0;s<3;s++)if(this.gridValues[t][s]===i)return 0;var n=0;for(s=0;s<3;s++)this.gridValues[t][s]===e&&n++;return n}return 0},r=function(t,e,i){var s;if(t<3){for(s=0;s<3;s++)if(this.gridValues[s][t]===i)return 0;var n=0;for(s=0;s<3;s++)this.gridValues[s][t]===e&&n++;return n}return 0},u=function(t,e,i){var s,n;if(t){for(s=0;s<3;s++)if(this.gridValues[s][s]===i)return 0;for(s=n=0;s<3;s++)this.gridValues[s][s]===e&&n++;return n}for(s=0;s<3;s++)if(this.gridValues[s][2-s]===i)return 0;for(s=n=0;s<3;s++)this.gridValues[s][2-s]===e&&n++;return n},i=function(t,e){var i,s=0;for(i=0;i<3;i++)s=Math.max(s,n.apply(this,[i,t,e]));for(i=0;i<3;i++)s=Math.max(s,r.apply(this,[i,t,e]));return s=Math.max(s,u.apply(this,[!0,t,e])),Math.max(s,u.apply(this,[!1,t,e]))},s=function(){return 3===i.apply(this,[this.PLAYER,this.CPU])||3===i.apply(this,[this.CPU,this.PLAYER])||!function(){var t,e;for(t=0;t<3;t++)for(e=0;e<3;e++)if(this.gridValues[t][e]===this.EMPTY)return!0;return!1}.apply(this)};return{getPlayerValue:i,getValue:function(t,e){return i.apply(this,[t,e])-i.apply(this,[e,t])},setGrid:function(t){var e,i,s,n=!0;if(3===t.length)for(e=0;e<3;e++)3!==t[e].length&&(n=!1);else n=!1;if(n)for(i=0;i<3;i++)for(s=0;s<3;s++)this.gridValues[i][s]=t[i][s]},getChildren:function(t){var e,i,s,n,r=[];for(e=0;e<3;e++)for(i=0;i<3;i++)this.gridValues[e][i]===this.EMPTY&&((s=a.apply(this,[t]))[e][i]=t,(n=new TicTacToeStatus).setGrid(s),r.push(n));return r},isEnd:s,playerWon:function(t,e){return s.apply(this)&&3===i.apply(this,[t,e])}}}();var circle=!0,mouseClicked=function(t,e,i,s){circle?drawCircle(t,e,i,s):drawX(t,e,i,s),circle=!circle},clear=function(t,e){var i="#000000";t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height),t.beginPath(),t.moveTo(0,e.height/3),t.lineTo(e.width,e.height/3),t.strokeStyle=i,t.stroke(),t.beginPath(),t.moveTo(0,2*e.height/3),t.lineTo(e.width,2*e.height/3),t.strokeStyle=i,t.stroke(),t.beginPath(),t.moveTo(e.width/3,0),t.lineTo(e.width/3,e.height),t.strokeStyle=i,t.stroke(),t.beginPath(),t.moveTo(2*e.width/3,0),t.lineTo(2*e.width/3,e.height),t.strokeStyle=i,t.stroke()},drawCircle=function(t,e,i,s){t.beginPath();var n=Math.min(e.height/10,e.width/10);t.arc(i*e.height/3+e.height/6,s*e.width/3+e.width/6,n,0,2*Math.PI,!0),t.fillStyle="#FF6A6A",t.fill()},drawX=function(t,e,i,s){var n=Math.min(e.height/10,e.width/10);t.beginPath(),t.moveTo(i*e.height/3+e.height/6-n,s*e.width/3+e.width/6-n),t.lineTo(i*e.height/3+e.height/6+n,s*e.width/3+e.width/6+n),t.strokeStyle="green",t.lineWidth=4,t.stroke(),t.beginPath(),t.moveTo(i*e.height/3+e.height/6-n,s*e.width/3+e.width/6+n),t.lineTo(i*e.height/3+e.height/6+n,s*e.width/3+e.width/6-n),t.strokeStyle="green",t.lineWidth=4,t.stroke()},update=function(t,e,i){var s,n;if(clear(e,i),t&&t.gridValues)for(s=0;s<3;s++)for(n=0;n<3;n++)t.gridValues[s][n]!==t.EMPTY&&(t.gridValues[s][n]===t.PLAYER?drawX(e,i,s,n):t.gridValues[s][n]===t.CPU&&drawCircle(e,i,s,n))},hiddenWhoPlayFirst=function(){document.getElementById("whoPlayFirst").remove()},setGameplay=function(t){var r=document.getElementById("tictactoeCanvas"),e=r.getContext("2d"),a=new TicTacToeEngine;a.listener={update:function(t){update(t,e,r)}},clear(e,r),t||a.cpuPlay(),r.addEventListener("click",function(t){var e=t.pageX-r.offsetLeft,i=t.pageY-r.offsetTop,s=0,n=0;n=e<=r.height/3?0:e<=2*r.height/3?1:2,s=i<=r.width/3?0:i<=2*r.width/3?1:2,a.play(n,s),a.playerWon()?(document.getElementById("message").style.textAlign="center",document.getElementById("message").innerHTML="Você ganhou!!!",document.getElementById("message").style.color="green",document.getElementById("message").style.visibility="visible"):a.cpuWon()?(document.getElementById("message").style.textAlign="center",document.getElementById("message").innerHTML="Você perdeu!!!",document.getElementById("message").style.color="red",document.getElementById("message").style.visibility="visible"):a.isEnd()&&(document.getElementById("message").style.textAlign="center",document.getElementById("message").innerHTML="Empatou!!!",document.getElementById("message").style.color="orange",document.getElementById("message").style.visibility="visible")})};document.addEventListener("DOMContentLoaded",function(){document.getElementById("cpuButtonClicked").addEventListener("click",function(t){hiddenWhoPlayFirst(),setGameplay(!1)}),document.getElementById("playerButtonClicked").addEventListener("click",function(t){hiddenWhoPlayFirst(),setGameplay(!0)})});